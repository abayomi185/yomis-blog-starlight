---
import { Image } from 'astro:assets';

export interface GalleryImage {
  src: ImageMetadata;
  alt?: string;
}

export interface Props {
  images: GalleryImage[];
  alt?: string;
  columns?: number;
  gap?: string;
  maxWidth?: string;
  showCaptions?: boolean;
  class?: string;
}

const {
  images,
  alt = '',
  columns = 3,
  gap = '1rem',
  maxWidth = '1200px',
  showCaptions = false,
  class: className
} = Astro.props;
---

<>
  <div
    class={`image-gallery ${className || ''}`}
    style={`--columns: ${columns}; --gap: ${gap}; max-width: ${maxWidth};`}
  >
    {
      images.map((image) => (
        <figure class="gallery-item">
          <Image src={image.src} alt={image.alt || ''} class="gallery-image" />
          {showCaptions && <figcaption class="gallery-caption">{image.alt || ''}</figcaption>}
        </figure>
      ))
    }
  </div>
  {(<figcaption class="gallery-caption">{alt}</figcaption>)}
</>

<style>
  .image-gallery {
    display: grid;
    grid-template-columns: repeat(var(--columns), 1fr);
    gap: var(--gap);
    margin: 2rem auto;
    padding: 0;
  }

  .gallery-item {
    margin: 0;
    display: flex;
    flex-direction: column;
  }

  .gallery-image {
    width: 100%;
    height: 200px;
    object-fit: cover;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    transition:
      transform 0.3s ease,
      box-shadow 0.3s ease;
  }

  .gallery-image:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
  }

  .gallery-caption {
    margin-top: 0.5rem;
    font-size: 0.875rem;
    color: #666;
    text-align: center;
    font-style: italic;
    line-height: 1.4;
  }

  /* Dark mode support */
  :global(.dark) .gallery-caption {
    color: #aaa;
  }

  /* Responsive breakpoints */
  @media (max-width: 768px) {
    .image-gallery {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 480px) {
    .image-gallery {
      grid-template-columns: 1fr;
    }
  }

  /* Auto-adjust columns based on number of images */
  .image-gallery:has(.gallery-item:nth-child(1):last-child) {
    grid-template-columns: 1fr;
    max-width: 400px;
  }

  .image-gallery:has(.gallery-item:nth-child(2):last-child) {
    grid-template-columns: repeat(2, 1fr);
    max-width: 800px;
  }
</style>
